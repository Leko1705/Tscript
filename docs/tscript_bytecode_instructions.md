
# Tscript Bytecode Instruction Set


This is a list of the instructions that make up the Tscript bytecode,
an abstract machine language that is ultimately executed by the
*Tscript Virtual Machine*. The Tscript bytecode is generated from languages
running on the Tscript Platform, most notably the *Tscript programming language*.<p>

<b>Note:</b> 
`op-stack` stands for `operand-stack` (see more in the runtime specifications). 
The most left value is on top of the stack.

| Opcode |      Name       | args (in bytes) |                                                                                                                                                                                                                                                                                                                                                                           Description |                                                           Stack Operation (before -> after) |
|--------|:---------------:|----------------:|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|--------------------------------------------------------------------------------------------:|
| 0      |    PUSH_NULL    |               0 |                                                                                                                                                                                                                                                                                                                                            Pushes the `null` value onto the op-stack. |                                                                              `[] -> [null]` |
| 1      |    PUSH_INT     |               1 |                                                                                                                                                                                                                                                                                                                                 Pushes an integer -128 <= x <= 127 onto the op-stack. |                                                                          `[] -> [some_int]` |
| 2      |    PUSH_BOOL    |               1 |                                                                                                                                                                                                                                                                                                             Pushes the boolean `true` onto the op-stack if the arg is 1 else `false`. |                                                                         `[] -> [some_bool]` |
| 3      |   LOAD_CONST    |               2 |                                                                                                                                                                                                  Loads the constant from the constant pool indexed by the 2 byte arguments. A constant is one of the following types: Integer, Boolean, Real, String, Null, Range, Array, Dictionary. |                                                                                 `[] -> [c]` |
| 4      |    PUSH_THIS    |               0 |                                                                                                                                                                                                                                                                                                                                                      Pushes `this` onto the op-stack. |                                                                              `[] -> [this]` |
| 5      |   LOAD_NATIVE   |               2 |                                                                                                                                                                      Loads a native function onto the op-stack. The function is loaded by name. The name is loaded from the constant pool by its 2 byte address. Throws an error if the native function for this name does not exist. |                                                                   `[] -> [native_function]` |
| 6      |  LOAD_VIRTUAL   |               2 |                                                                                                                                                                                                                                                     Loads a virtual function onto the op-stack. The function is loaded by the given 2 byte index (see more in the functions section). |                                                                  `[] -> [virtual_function]` |
| 7      |  LOAD_BUILTIN   |               2 |                                                                                                                                                                                                                                                                                 Loads a builtin object of any type onto the op-stack. The object is loaded by the given 2 byte index. |                                                                  `[] -> [virtual_function]` |
| 8      |    SET_OWNER    |               0 |                                                                                                                          Removes a function as the top element from the op-stack then removes and assigns the new top element as the owner to that function. The modified function is then pushed back onto the op-stack. Throws an error if the first top element is not a Function. |                                                           `[function, owner] -> [function]` |
| 9      |     EXTEND      |               2 |                                                                                                                                                                               Removes the top two elements of the stack and adds the second one as a new private mutable member into the first one. The name of this new member is loaded from constant pool by the 2 byte arguments. |                                                    `[object, new_member_initializer] -> []` |
| 10     |    LOAD_TYPE    |               2 |                                                                                                                                                                                                                                      Loads a type onto the op-stack, that is stored in the bytecode. The function is loaded by the given 2 byte index (see more in the type section). |                                                                              `[] -> [type]` |
| 11     |   BUILD_TYPE    |               2 |                                                              Builds a new type by binding the super type to the given type. The super type is removed from the op-stack, whereas the sub type is created as in the `LOAD_TYPE` instruction. If the type is already build this instruction behaves like the `LOAD_TYPE` instruction. The result type is then pushed onto the op-stack. |                                                                              `[] -> [type]` |
| 12     |       POP       |               0 |                                                                                                                                                                                                                                                                                                                                            Removes the top element from the op-stack. |                                                                               `[top] -> []` |
| 13     |    NEW_LINE     |               4 |                                                                                                                                                                                                                                                                                           Marks that a new line is reached. The line is encoded as a 4 byte integer by the arguments. |                                                                                  `[] -> []` |
| 14     |   LOAD_GLOBAL   |               1 |                                                                                                                                                                                                                                                                                                                                      Loads an element by index from the global scope. |                                                                       `[] -> [some_global]` |
| 15     |  STORE_GLOBAL   |               1 |                                                                                                                                                                                                                                                          Removes the top element from the op-stack and stores it by index into the global scope. The registers mutability is ignored. |                                                                       `[some_global] -> []` |
| 16     |   LOAD_LOCAL    |               1 |                                                                                                                                                                                                                                                                              Removes the top element from the op-stack and stores it into the local register indexed by the argument. |                                                                        `[] -> [some_local]` |      
| 17     |   STORE_LOCAL   |               1 |                                                                                                                                                                                                                                                                              Removes the top element from the op-stack and stores it into the local register indexed by the argument. |                                                                        `[some_local] -> []` |
| 18     |  LOAD_EXTERNAL  |               2 |     Performs an external member read operation by removing the accessed element from the top of the op-stack and accesses the member my its name. The name is accessed from the constant pool by the argument. The accessed member is then pushed onto the op-stack. An error is thrown if the given member does not exist in this object or if it is not accessible from this scope. |                                                                      `[obj] -> [obj.field]` |
| 19     | STORE_EXTERNAL  |               2 | Performs an external member write operation by removing the top two elements from the op-stack and stores the second removed element as a member into the first one by name. The name is accessed from the constant pool by the argument. An error is thrown if the given member does not exist in this object, if it is not accessible from this scope or if the field is immutable. |                                                                     `[obj, to_store] -> []` |
| 20     |  LOAD_INTERNAL  |               2 |                                                                                                                                                                                     Performs an internal member read operation of `this` by index and pushes the accessed element onto the stack. The index is given by the 2 byte argument. Visibilities are not taken into account. |                                                                        `[] -> [this.field]` |
| 21     | STORE_INTERNAL  |               2 |                                                                                                                                                           Performs an internal member write operation by removing the top element from the op-stack and stores it as a member of `this` by index. The index is given by the 2 byte argument. Visibilities are not taken into account. |                                                                          `[to_store] -> []` |
| 22     |   LOAD_SUPER    |               2 |                                                                                                           Loads an objects member from its super instance onto the op-stack. The member is searched by name, whereas the name is accessed by the two bytes argument from the constant pool. If either the member name does not exist or its visibility is private an error is thrown. |                                                                        `[] -> [super.name]` |
| 23     |   STORE_SUPER   |               2 |                                                                                                         Stores the top element into the second tops super instance member. The member is determined by name, whereas the name is accessed by the two bytes argument from the constant pool. If either the member name does not exist or its visibility is private an error is thrown. |                                                                     `[obj, to_store] -> []` |
| 24     |   LOAD_STATIC   |               2 |                                                                                                                Loads a static field by name and pushes it onto the op-stack. The accessed object is `this`. The name is accessed from the constant pool by the argument. An error is thrown if the given member does not exist in this type. Visibilities are not taken into account. |                                                               `[] -> [static_field_of_obj]` |
| 25     |  STORE_STATIC   |               2 |                                                              Removes the top element from the op-stack and stores it into the static field of `this` by name. The name is accessed from the constant pool by the argument. An error is thrown if the given member does not exist in this type. An error is thrown if the field is immutable. Visibilities are not taken into account. |                                                               `[static_field_of_obj] -> []` |
| 26     | CONTAINER_READ  |               0 |                                                                                                                  Removes the top two elements from the op-stack and accesses the first removes as a container with the second one as the key. The accessed value is then pushed onto the op-stack. An error is thrown if the accessed object is not accessible via the `[]` operator. |                                                               `[container, key] -> [value]` |
| 27     | CONTAINER_WRITE |               0 |                                                                                                                                            Removes the top three elements from the op-stack and stores the third one (the value) into the first one (the container) with the second one as the key. An error is thrown if the accessed object is not writeable via the `[]` operator. |                                                             `[container, key, value] -> []` |
| 28     |  LOAD_ABSTRACT  |               2 |                                                                                                                                                                                                 Loads the implementation of an as abstract defined function by name. The name is accessed from the constant pool by the argument. Throws an error if the implementation is not found. |                                                            `[] -> [abstract_function_impl]` |
| 29     |       ADD       |               0 |                                                                                                                                                                             Removes the top two elements from the op-stack and performs an addition on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 30     |       SUB       |               0 |                                                                                                                                                                           Removes the top two elements from the op-stack and performs a subtraction on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 31     |       MUL       |               0 |                                                                                                                                                                        Removes the top two elements from the op-stack and performs a multiplication on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 32     |       DIV       |               0 |                                                                                                                                                                              Removes the top two elements from the op-stack and performs a division on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 33     |      IDIV       |               0 |                                                                                                                                                                     Removes the top two elements from the op-stack and performs an integer division on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 34     |       MOD       |               0 |                                                                                                                                                                      Removes the top two elements from the op-stack and performs a modulo operation on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 35     |       POW       |               0 |                                                                                                                                                                                              Removes the top two elements from the op-stack and powers them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                              `[exponent, base] -> [result]` |
| 36     |       AND       |               0 |                                                                                                                                                                        Removes the top two elements from the op-stack and performs an and operation on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 37     |       OR        |               0 |                                                                                                                                                                         Removes the top two elements from the op-stack and performs an or operation on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 38     |       XOR       |               0 |                                                                                                                                                                         Removes the top two elements from the op-stack and performs a xor operation on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 39     |       NOT       |               0 |                                                                                                                                                                             Removes the top element from the op-stack and performs a logical negation on it. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                      `[bool] -> [not bool]` |
| 40     |       LT        |               0 |                                                                                                                                             Removes the top two elements from the op-stack and compares them if the left element is less than the right one. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 41     |       GT        |               0 |                                                                                                                                          Removes the top two elements from the op-stack and compares them if the left element is greater than the right one. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 42     |       LEQ       |               0 |                                                                                                                                    Removes the top two elements from the op-stack and compares them if the left element is less or equal than the right one. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 43     |       GEQ       |               0 |                                                                                                                                 Removes the top two elements from the op-stack and compares them if the left element is greater or equal than the right one. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 44     |       SLA       |               0 |                                                                                                                                                     Removes the top two elements from the op-stack and performs a left arithmetical shift operation on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 45     |       SRA       |               0 |                                                                                                                                                    Removes the top two elements from the op-stack and performs a right arithmetical shift operation on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 46     |       SRL       |               0 |                                                                                                                                                         Removes the top two elements from the op-stack and performs a right logical shift operation on them. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                 `[right, left] -> [result]` |
| 47     |     EQUALS      |               0 |                                                                                                                                                                                                                                                     Removes the top two elements from the op-stack and compares them for their equality. The result is then pushed onto the op-stack. |                                                                 `[right, left] -> [result]` |
| 48     |   NOT_EQUALS    |               0 |                                                                                                                                                                                                                                                   Removes the top two elements from the op-stack and compares them for their inequality. The result is then pushed onto the op-stack. |                                                                 `[right, left] -> [result]` |
| 49     |       NEG       |               0 |                                                                                                                                                                                     Removes the top element from the op-stack and performs a negation on it. The result is then pushed onto the op-stack. An error is thrown if the operation is not applicable on the two arguments. |                                                                     `[number] -> [+number]` |
| 50     |       POS       |               0 |                                                                                                                                                   Removes the top element from the op-stack and signs it with `+`. The result is then pushed onto the op-stack. Effectively this operation has no effect. An error is thrown if the operation is not applicable on the two arguments. |                                                                     `[number] -> [-number]` |
| 51     |    GET_TYPE     |               0 |                                                                                                                                                                                                                                                                                                      Removes the top element from the op-stack and pushes its type onto the op-stack. |                                                                    `[obj] -> [type_of_obj]` |
| 52     |   MAKE_ARRAY    |               1 |                                                                                                                                                                                                                                                         Removes n top elements of the op-stack and stores them into a new array. The first element is the first element in the array. |                                                                  `[1, 2, 2] -> [[1, 2, 3]]` |
| 53     |    MAKE_DICT    |               1 |                                                                                                                                         Removes the 2 * n elements from the op-stack. for each 'tuple' the first element represents the key and the second one the value. Each pair is then stored into a new dictionary. The first removed tuple is the first one in the dictionary. |                                              `["hi", 1, "bye", 2] -> [{"hi": 1, "bye", 2}]` |
| 54     |   MAKE_RANGE    |               0 |                                                                                                                                                   Removes the top two elements from the op-stack and creates a new range from them. The first removed element is the 'from' value and the second value the 'to' value. Throws an error if one of the two arguments is not an integer. |                                                                   `[from, to] -> [from:to]` |
| 55     |      GOTO       |               2 |                                                                                                                                                                                                                                                                                                                   jumps to the absolute address given by the 2 byte integer argument. |                                                                                  `[] -> []` |
| 56     | BRANCH_IF_TRUE  |               2 |                                                                                                                                                                                                                            Removes the top element from the op-stack and checks for its truth value. If it is true an absolute jump to the given 2 byte integer address is performed. |                                                                                  `[] -> []` |
| 57     | BRANCH_IF_FALSE |               2 |                                                                                                                                                                                                                           Removes the top element from the op-stack and checks for its truth value. If it is false an absolute jump to the given 2 byte integer address is performed. |                                                                                  `[] -> []` |
| 58     |     GET_ITR     |               0 |                                                                                                                                                                                                                              Removes the top element from the op-stack and pushes it's iterator object onto the stack. Throws an error if the given object is not an iterable object. |                                                                     `[obj] -> [itr_of_obj]` |
| 59     |   BRANCH_ITR    |               2 |                                                                                                                                                                    Peeks the top element of the op-stack as an iterator object and checks if it has a next element. If not the iterator is removes from the op-stack and an absolute jump to the 2 byte integer address is performed. |                                        if true: `[itr] -> [itr]`<br>if false: `[itr] -> []` |
| 60     |    ITR_NEXT     |               0 |                                                                                                                                                                                                                                                                            Peeks the top element from the op-stack as an iterator object and pushes its next value onto the op-stack. |                                                          `[itr] -> [next_itr_element, itr]` |
| 61     |    ENTER_TRY    |               2 |                                                                                                                                                                                                                                                                                     Maks that an try block has been entered by storing the escape address in case of an caught error. |                                                                                  `[] -> []` |
| 62     |    LEAVE_TRY    |               0 |                                                                                                                                                                                                                                                                                                                                                        Unmarks the entered try block. |                                                                                  `[] -> []` |
| 63     |      THROW      |               0 |                                                                                                                                                                                                   Removes the top element from the op-stack and throws this element as an exception. If the backtracking ends in a try block the thrown value is pushed back onto the (new) op-stack. |                                                                           `[throwed] -> []` |
| 64     |  CALL_INPLACE   |               1 |                                                                                                    Removes the top element from the op-stack as the function and n further elements as the arguments The amount of parameters is specified by the 1 byte argument. Throws an error if the called object is not callable or if the argument amount does not match the parameter count. |                                                                  `[func, p1, p2, p3] -> []` |
| 65     |   CALL_MAPPED   |               1 |                                                           Removes the top element from the op-stack as the called function and n more mapped-arguments, crated by `TO_MAP_ARG` and `TO_NO_MAP_ARG`. The amount of parameters is specified by the 1 byte argument. Errors are the same as for `CALL` instruction, including naming checks, meaning if a required parameter is not set. |                                                                  `[func, param_dict] -> []` |
| 66     |   TO_MAP_ARG    |               2 |                                                                                                                                                                                                                    Removes the top element from the op-stack and pushes it back as a mapped-argument. The mapping-name is loaded from the constant pool by the 2 byte index argument. |                                                            `[obj] -> [Argument{name->obj}]` |
| 67     |   TO_INP_ARG    |               0 |                                                                                                                                                                                                                                                                                                  Removes the top element from the op-stack and pushes it back as an inplace-argument. |                                                                  `[obj] -> [Argument{obj}]` |
| 68     |     RETURN      |               0 |                                                                                                                                                                                                                           Removes the top element from the op-stack and returns it from the function. The returned element is then pushed onto the op-stack of the previous function. | in from returned function: `[return_value] -> []`<br>in to returned: `[] -> [return_value]` |
| 69     |   CALL_SUPER    |               1 |                                                                                                                                                                                                  Removes the top n elements from the op-stack and passes them to the function call of the super constructor of `this`. The amount of parameters is determined by the 1 byte argument. |                                                                  `[func, p1, p2, p3] -> []` |
| 70     |     IMPORT      |               2 |                                                                             Loads a new or exising module into the module area for later access and pushes it onto the op-stack. If the module is not executed yet it will now. The module path is loaded from the constant pool by the given 2 byte index. Throws an error if the module does not exist or a loading error occurred. |                                                                     `[] -> [loaded_module]` |
| 71     |       USE       |               0 |                                                                                                                                                                                 Removes the top element from the op-stack as a module or namespace and stores all its members into the local name registers. Throws an error if the given object is neither a module nor a namespace. |                                                                                  `[] -> []` |
| 72     |    LOAD_NAME    |               2 |                                                                                           Loads an element from the name registers, by searching from the current local scope upwards to the most outer accessible scope, followed by the global scope. The name is loaded from the constant pool by the 2 byte index argument. Throws an error if the looked up name does not exist. |                                                                                  `[] -> []` |
| 73     |       DUP       |               0 |                                                                                                                                                                                                                                                                                                                Duplicates the top element and pushes the duplicate onto the op-stack. |                                                           `[element] -> [element, element]` |
